{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>View Ticket</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/layout.css' %}" id="layout-style">
    <link rel="stylesheet" type="text/css" href="{% static 'css/view_ticket.css' %}" id="view_ticket-style">
    <script type="text/javascript" src="{% static 'js/username-popup.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/toggle-edit.js' %}"></script>
    <link rel="shortcut icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon">
</head>
<body>
    <div class="sidebar">
        <img src="{% static 'images/icon.png' %}" class="sidebar-icon">
        <a href="{% url 'index' %}">Home</a>
        <a href="{% url 'login' %}">Login</a>
        <a href="{% url 'register' %}">Register</a>
    </div>
          
    <div class="username-container" id="username-container">
        <img src="{% static 'images/default_user.png' %}" alt="Default Account Image">
    </div>    

    <div id="user-popup" style="display: none;">
        <p>Name: {{ user.username }}</p>
        <p>Email: {{ user.email }}</p>
        <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <input type="submit" value="Logout">
        </form>
    </div>    

    <div id="ticket-container">
        {% if user != ticket.user %}
            <h1 class="ticket-title">{{ ticket.title }}</h1>
            <span class="ticket-username">Creator: {{ ticket.user.username }}</span>
            <span class="ticket-date">Created at: {{ ticket.create_time|date:'d.m.Y' }}</span>
            <span class="ticket-assigned-users"> Assgined Users: 
                {% for user in ticket.assigned_users.all %}
                    {{ user.username }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </span>
            <span class="ticket-type">Type: {{ ticket.type }}</span>
            <span class="ticket-relevance">Rel: {{ ticket.relevance }}</span>
            <span class="ticket-status" 
                {% if ticket.status == "Open" %} style="background-color: rgb(33, 75, 139);"
                {% elif ticket.status == "In progress" %} style="background-color: orange;"
                {% elif ticket.status == "Closed" %} style="background-color: red;"
                {% else %} style="background-color: green;"
                {% endif %}>
                {{ ticket.status }}
            </span>
            <span class="ticket-content">{{ ticket.content }}</span>
        {% else %}
            <div id="ticket-display">
                <h1 class="ticket-title">{{ ticket.title }}</h1>
                <span class="ticket-username">Creator: {{ ticket.user.username }}</span>
                <span class="ticket-date">Created at: {{ ticket.create_time|date:'d.m.Y' }}</span>
                <span class="ticket-assigned-users"> Assgined Users: 
                    {% for user in ticket.assigned_users.all %}
                        {{ user.username }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </span>
                <span class="ticket-type">Type: {{ ticket.type }}</span>
                <span class="ticket-relevance">Rel: {{ ticket.relevance }}</span>
                <span class="ticket-status" 
                    {% if ticket.status == "Open" %} style="background-color: rgb(33, 75, 139);"
                    {% elif ticket.status == "In progress" %} style="background-color: orange;"
                    {% elif ticket.status == "Closed" %} style="background-color: red;"
                    {% else %} style="background-color: green;"
                    {% endif %}>
                    {{ ticket.status }}
                </span>
                <button id="ticket-edit-button" onclick="toggleEdit()">Edit</button>
                <form id="ticket-close-form" method="post" style="display: inline-block;">
                    {% csrf_token %}
                    <input id="ticket-close-submit" type="submit" value="Close" name="close">
                </form>
                
                <span class="ticket-content">{{ ticket.content }}</span>
            </div>
            <form id="ticket-edit-form" method="post",  style="display: none;">
                {% csrf_token %}
                <div class="form-group">
                    <label for="ticket-title">Title:</label>
                    <input type="text" class="form-control" id="ticket-title-edit" name="ticket-title" value="{{ ticket.title }}">
                </div>
                <div class="form-group">
                    <label for="ticket-content-edit">Content:</label>
                    <textarea class="form-control" id="ticket-content" name="ticket-content" rows="3">{{ ticket.content }}</textarea>
                </div>
                <div class="form-group">
                    <label for="ticket-assigned-users">Assigned Users:</label>
                    <select multiple class="form-control" id="ticket-assigned-users-edit" name="ticket-assigned-users">
                        {% for user in users %}
                            <option value="{{ user.id }}">{{ user.username }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="ticket-type">Type:</label>
                    <select class="form-control" id="ticket-type-edit" name="ticket-type">
                        <option value="{{ ticket.type }}" selected>{{ ticket.type }}</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="ticket-relevance">Relevance:</label>
                    <select class="form-control" id="ticket-relevance-edit" name="ticket-relevance">
                        <option value="{{ ticket.relevance }}" selected>{{ ticket.relevance }}</option>
                    </select>
                </div>
                <input type="submit" id="submit-save" value="Save" class="submit-save">
                <input type="button" id="submit-cancel" value="Cancel" class="submit-cancel" onclick="toggleEdit()">
            </form>      
        {% endif %}
    </div>
    
    <div id="ticket-replies-container">
        <h2>Replies:</h2>
        {% for reply in replies %}
            <div id="ticket-reply">
                <p id="ticket-reply-content">{{ reply.content }}</p>
            </div>
        {% endfor %}
        <form id="ticket-reply-form" method="post">
            {% csrf_token %}
            <textarea id="ticket-reply-textarea" name="content"></textarea>
            <input id="ticket-reply-submit" type="submit" value="Reply" name="Reply">
        </form>
    </div>

</body>
</html>    
